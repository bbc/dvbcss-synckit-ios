<!DOCTYPE html>
<html lang="en">
  <head>
    <title>CIIProtocolClient  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>


    <a title="CIIProtocolClient  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          CIIProtocolClient Docs
        </a>
         (39% documented)
      </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/bbc/dvbcss-synckit-ios/tree/master/src/CIIProtocolClient">
            <img class="header-icon" src="img/gh.png"/>
            View on GitHub
          </a>
        </p>
    
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">CIIProtocolClient Reference</a>
      <img class="carat" src="img/carat.png" />
      CIIProtocolClient  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CII.html">CII</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/CIIClient.html">CIIClient</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TimelineOption.html">TimelineOption</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/TimelineProperties.html">TimelineProperties</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Constants.html">Constants</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@CIIProtocolClientVersionNumber">CIIProtocolClientVersionNumber</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@CIIProtocolClientVersionString">CIIProtocolClientVersionString</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kCIIChangeStatusMask">kCIIChangeStatusMask</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kCIIConnectionFailure">kCIIConnectionFailure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kCIIDidChange">kCIIDidChange</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kMRSUrl">kMRSUrl</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kaccuracy">kaccuracy</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kcontentId">kcontentId</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kcontentIdStatus">kcontentIdStatus</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kpresentationStatus">kpresentationStatus</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kprotocolVersion">kprotocolVersion</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ktimelineProperties">ktimelineProperties</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ktimelineSelector">ktimelineSelector</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ktimelines">ktimelines</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@ktsUrl">ktsUrl</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kunitsPerSecond">kunitsPerSecond</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kunitsPerTick">kunitsPerTick</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Constants.html#/c:@kwcUrl">kwcUrl</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Enums.html">Enums</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/CIIChangeStatus.html">CIIChangeStatus</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content">
            
            <a href='#ciiprotocolclient-ios-framework-library' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h1 id='ciiprotocolclient-ios-framework-library'>CIIProtocolClient iOS Framework Library</h1>

<ul>
<li><strong><a href="#how-to-use">How to use</a></strong></li>
<li><strong><a href="#read-the-documentation">Read the documentation</a></strong></li>
<li><strong><a href="#run-the-example-app">Run the example app</a></strong></li>
</ul>

<p>A client component for the CSS-CII protocol specified in the DVB-CSS and HbbTV2.0 specifications . It is used by Companion Screen applications to create a setup a connection with an HbbTV device to receive content identifiers and other information such as
* as other DVB-CSS protocol sevice endpoints (CSS-WC, CSS-TS server endpoints)
* available timelines for synchronisation</p>
<a href='#dependencies' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h3 id='dependencies'>Dependencies</h3>

<p>The CIIProtocolClient library requires the following dynamic libraries (iOS frameworks) (found in SyncKit):</p>

<ol>
<li><a href="../SyncKitConfiguration">SyncKitConfiguration</a></li>
<li><a href="../SimpleLogger">SimpleLogger</a></li>
<li><a href="../SocketRocket">SocketRocket</a> - the SocketRocket web socket library</li>
<li><a href="../SyncKitCollections">SyncKitCollections</a></li>
</ol>
<a href='#read-the-documentation' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='read-the-documentation'>Read the documentation</h2>

<p>The docs for the library can be read <a href="CIIProtocolClient/docs/index.html">here</a>.</p>
<a href='#how-to-use' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='how-to-use'>How to use</h2>

<p>A Cocoa Pod version of this library is not currently available. To use this library, follow these steps</p>
<a href='#add-the-framework-and-its-dependencies-to-your-project' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='add-the-framework-and-its-dependencies-to-your-project'>Add the framework and its dependencies to your project</h4>

<ol>
<li><em>Add the required projects to your workspace</em></li>
</ol>

<p>The easiest way to use the WallClockClient framework is to include these Xcode projects to your XCode workspace.</p>

<ol>
<li><a href="../SyncKitConfiguration">SyncKitConfiguration</a></li>
<li><a href="../SimpleLogger">SimpleLogger</a></li>
<li><a href="../SocketRocket">SocketRocket</a> - the SocketRocket web socket library</li>
<li><a href="../SyncKitCollections">SyncKitCollections</a></li>
</ol>

<p>Then, after building these projects, go to your project&rsquo;s target window and <em>click on project in Project Navigator, then the project&rsquo;s target on right window in General tab</em>), add these frameworks in the <em>Linked Frameworks and libraries</em> section: <em>SyncKitConfiguration.framework, SimpleLogger.framework, SocketRocketiOS.framework, SyncKitCollections.framework</em>.</p>

<ol>
<li><em>Add the dynamic libraries to your project</em></li>
</ol>

<p>Or alternatively, clone the SyncKit repository, open the main workspace and build all the projects.</p>

<p>Then, in your project&rsquo;s target window (<em>click on project in Project Navigator, then the project&rsquo;s target on right window in General tab</em>), add the framework files in the <em>Linked Frameworks and libraries</em> section: <em>SyncKitConfiguration.framework, SimpleLogger.framework, SocketRocketiOS.framework, SyncKitCollections.framework</em>.
  If you have two XCode instances running you can drag and drop the framework files from their respective project in SyncKit to your own project.</p>

<ol>
<li><em>Use the Cocoa Pod version</em></li>
</ol>

<p>Not available yet.</p>
<a href='#import-the-header-files' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='import-the-header-files'>Import the header files</h4>

<p>Once the library and its dependencies have been added to your project, import this header file in your source file:</p>
<pre class="highlight plaintext"><code>
  #import &lt;CIIProtocolClient/CIIProtocolClient.h&gt;

</code></pre>
<a href='#create-and-configure-a-ciiprotocolclient-object' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='create-and-configure-a-ciiprotocolclient-object'>Create and configure a CIIProtocolClient object</h4>

<p>When a TV is discovered using the DIALDeviceDiscovery component, the CSS-CII URL reported in the <code>HbbTV_InterDevSyncURL</code> property of a DIALDevice object.
Use this to initialise a protocol client i.e. a <a href="">CIIClient</a> instance.</p>
<pre class="highlight plaintext"><code>  NSString* const kHbbTV_InterDevSyncURL = @"ws://192.168.0.7:7681/cii";

  CIIClient cssCIIClient = [[CIIClient alloc] initWithCIIURL:kHbbTV_InterDevSyncURL];

  if (cssCIIClient)
      [cssCIIClient start];

</code></pre>
<a href='#register-for-notifications-about-new-cii-received-or-css-cii-websocket-connection-failure' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='register-for-notifications-about-new-cii-received-or-css-cii-websocket-connection-failure'>Register for notifications about new CII received or CSS-CII WebSocket connection failure</h4>
<pre class="highlight plaintext"><code>
// --- register for CIIProtocolClient notifications ---
  [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(handleCIINotifications:) name:kCIIConnectionFailure object:nil];

  [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(handleCIINotifications:) name:kCIIDidChange object:nil];



</code></pre>
<a href='#handle-notifications-about-cii-changes-or-connection-failures' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h4 id='handle-notifications-about-cii-changes-or-connection-failures'>Handle notifications about CII changes or connection failures</h4>

<p>A change in a received CII is indicated by the appropriate bit being set in a bitmask.  To determine
which fields have changed in a new CII object, use the CIIChangeStatus bitmask in the notification handler routine.</p>
<pre class="highlight plaintext"><code>- (void) handleCIINotifications:(NSNotification*) notification
{
    NSUInteger ciiChangeStatus=0;

    // --- 2. Handle new CII and start WallClock synchronisation ----

    if  ([[notification name] caseInsensitiveCompare:kCIIDidChange] == 0) {

        id temp = [[notification userInfo] objectForKey:kCIIDidChange];

        NSNumber *status = [[notification userInfo] objectForKey:kCIIChangeStatusMask];

        if (status) {
            ciiChangeStatus = [status unsignedIntegerValue];
        }


        if ((ciiChangeStatus &amp; NewCIIReceived) !=0)
        {
            NSLog(@"CSSynchroniser: Received New CII notification ... ");


            if ([temp isKindOfClass:[CII class]])
            {
                currentCII = temp;
            }
        }

        if (ciiChangeStatus  &amp; ContentIdChanged) {

            if ([temp isKindOfClass:[CII class]])
            {
                currentCII = temp;
            }
            // TODO: Handle ContentId change

            // content Id has changed.

            // ...

        }
    }

</code></pre>
<a href='#run-the-example-app' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='run-the-example-app'>Run the example app</h2>

<p>A demo app called <a href="CIIProtocolClientDemoApp/">CIIProtocolClientDemoApp</a> is included with this framework. To run the demo,open the CIIProtocolClient project in XCode. Choose the CIIProtocolClientDemoApp target, build it and deploy the app on your iOS device or run it in the simulator.</p>

<p>The CSS-CII URL is hardcoded in <code>ViewController.m</code>:</p>
<pre class="highlight plaintext"><code>NSString* const kHbbTV_InterDevSyncURL = @"ws://192.168.0.7:7681/cii";
</code></pre>

<p>Replace the URL with your own CII server instance URL</p>

<p>On the server side, if you need an example implementation of a CSS-CII server, then clone the following library:
[<a href="https://github.com/bbc/pydvbcss">https://github.com/bbc/pydvbcss</a>]. The <code>examples</code> folder has a server implementation: <code>CIIServer.py</code></p>
<pre class="highlight plaintext"><code>$ python examples/CIIServer.py
</code></pre>

<p>The server listens on 127.0.0.1 on port 7681 and accepts WebSocket connections to <em>ws://<ip>:<port>/cii</em>.</p>
<a href='#licence' class='anchor' aria-hidden=true><span class="header-anchor"></span></a><h2 id='licence'>Licence</h2>

<p>The CIIProtocolClient iOS Framework is developed by BBC R&amp;D and distributed under Licensed under the Apache License, <a href="http://www.apache.org/licenses/LICENSE-2.0">Version 2.0</a>.</p>

<p>© Copyright 2016 BBC R&amp;D. All Rights Reserved</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2016 <a class="link" href="http://bbc.co.uk/rd" target="_blank" rel="external">Rajiv_Ramdhany</a>. All rights reserved. (Last updated: 2016-09-21)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.7.0</a>, a <a class="link" href="http://realm.io" target="_blank" rel="external">Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
